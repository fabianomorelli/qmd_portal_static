var layer_osm=new ol.layer.Tile({source:new ol.source.OSM}),area_queimada_wms="//sirc.dgi.inpe.br/wms?",layer_biomas=new ol.layer.Tile({source:new ol.source.TileWMS({url:area_queimada_wms,params:{layers:"biomas",transparent:!0},serverType:"mapserver"}),opacity:.5}),layer_aq_renata=new ol.layer.Tile({source:new ol.source.TileWMS({url:area_queimada_wms,params:{layers:"aq_renata"},serverType:"mapserver"})}),layers=[layer_osm,layer_biomas,layer_aq_renata],view=new ol.View({center:ol.proj.transform([-45,-15],"EPSG:4326","EPSG:3857"),zoom:5}),map=new ol.Map({layers:layers,target:"map",view:view,controls:ol.control.defaults().extend([new ol.control.FullScreen])}),ano={ultimo:(new Date).getFullYear(),primeiro:2002,anterior:null,atual:(new Date).getFullYear()},mes={ultimo:(new Date).getMonth(),primeiro:9,atual:(new Date).getMonth(),label:["Total","Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]},biomas={mes:{head:[],body:[]},ano:{head:[],body:[]},atual:0,props:[{id:"brasil",name:"Brasil",color:"#cccccc",wms_name:"",area:8514877,extents:[-73.9930118393185,-33.752061,-34.7913386072274,5.2721979413042]},{id:"amazonia",name:"Amazônia",color:"#90b030",wms_name:"AMAZONIA",area:4196943,extents:[-73.9930118393185,-16.305786128394,-43.5921966305933,5.2721979413042]},{id:"caatinga",name:"Caatinga",color:"#fff0a0",wms_name:"CAATINGA",area:844453,extents:[-44.5084182238373,-16.0884761770876,-35.1717108419355,-2.78475219686381]},{id:"cerrado",name:"Cerrado",color:"#ffc0af",wms_name:"CERRADO",area:2036448,extents:[-60.109416688592,-24.6846267858074,-41.5221826757896,-2.33786709477697]},{id:"mata_atlantica",name:"Mata Atlântica",color:"#bfd0af",wms_name:"MATA_ATLANTICA",area:1110182,extents:[-55.6633933603613,-29.9513399985695,-34.7913386072274,-5.14304758517843]},{id:"pampa",name:"Pampa",color:"#ffe8d0",wms_name:"PAMPA",area:176496,extents:[-57.6437109999998,-33.752061,-49.6728850541475,-28.077339]},{id:"pantanal",name:"Pantanal",color:"#efe0ef",wms_name:"PANTANAL",area:150355,extents:[-59.1879572675777,-22.150888,-54.9218145373871,-15.5234898783163]}]},contrast=!1,loaded=0;0==mes.ultimo&&(mes.ultimo=12,ano.ultimo-=1),0==mes.atual&&(mes.atual=mes.ultimo,ano.atual=ano.ultimo);var table="",table_months="",qmd={graphics:{table_years:function(){var a=new google.visualization.DataTable,e=(a=new google.visualization.arrayToDataTable(getAnos()),new google.visualization.NumberFormat({groupingSymbol:".",fractionDigits:0}));for(i=1;i<a.getNumberOfColumns();i++)e.format(a,i);(table=new google.visualization.Table(document.getElementById("div_biomas_ano"))).draw(a,{showRowNumber:!1,width:"100%",height:"100%",cssClassNames:{tableRow:"text-right",oddTableRow:"text-right",selectedTableRow:contrast?"selected":"warning",headerCell:"text-center"}}),$("#div_biomas_ano table").addClass("table table-striped table-hover text-right metadata-anos small"),$("#div_biomas_ano table tr:last").addClass(contrast?"lastline":"info"),$('#div_biomas_ano table td:nth-child(1):contains("'+ano.atual+'")').first().parent().addClass(contrast?"selected":"warning"),updateLoading(10)},table_months:function(){var a=new google.visualization.arrayToDataTable(getMeses()),e=new google.visualization.NumberFormat({decimalSymbol:",",groupingSymbol:".",fractionDigits:0});for(i=2;i<a.getNumberOfColumns();i++)e.format(a,i);(table=new google.visualization.Table(document.getElementById("div_biomas_mes"))).draw(a,{showRowNumber:!1,width:"100%",height:"auto",language:"pt-BR",cssClassNames:{tableRow:"text-right",oddTableRow:"text-right",selectedTableRow:contrast?"selected":"warning",headerCell:"text-center"}}),$("#div_biomas_mes table").addClass("table table-striped table-hover text-right metadata-ano small"),$("#div_biomas_mes table tr:last").addClass(contrast?"lastline":"info"),$("#div_biomas_mes table td:nth-child(2)").filter(function(){return this.innerHTML==mes.atual}).parent().addClass(contrast?"selected":"warning"),montaFiltros("filtros"),updateLoading(10)},graphic_year:function(){var a=[];for(i in biomas.props)0<i&&(0!=biomas.atual&&i!=biomas.atual||a.push(biomas.props[i].color));var e={backgroundColor:contrast?"#000":"#fff",titleTextStyle:{color:contrast?"#fff":"#333"},height:450,hAxis:{title:ano.atual,titleTextStyle:{color:contrast?"#fff":"#333"},textStyle:{color:contrast?"#fff":"#333"},gridlines:{color:contrast?"#fff":"#333"}},vAxis:{title:"km²",titleTextStyle:{color:contrast?"#fff":"#333"},textStyle:{color:contrast?"#fff":"#333"},gridlines:{color:contrast?"#fff":"#333"}},legend:{position:"right",textStyle:{color:contrast?"#fff":"#333"}},colors:a},o=new google.visualization.arrayToDataTable(getGraficoBiomaMesesAno()),t=new google.visualization.NumberFormat({decimalSymbol:",",groupingSymbol:".",fractionDigits:0});for(i=1;i<o.getNumberOfColumns();i++)t.format(o,i);new google.visualization.ColumnChart(document.getElementById("div_graf_biomas_ano")).draw(o,e),updateLoading(10)},graphic_month:function(){var a=[];for(i in biomas.props)0<i&&a.push(biomas.props[i].color);var e={backgroundColor:contrast?"#000":"#fff",titleTextStyle:{color:contrast?"#fff":"#333"},height:450,legend:{position:"right",tooltip:{ignoreBounds:!1,trigger:"selection"},textStyle:{color:contrast?"#fff":"#333"}},pieSliceTextStyle:{color:"#000"},tooltip:{ignoreBounds:!1,trigger:"selection"},title:"Clique na legenda ou no gráfico para ver os valores para os biomas selecionados",colors:a},o=new google.visualization.arrayToDataTable(getGraficoBiomasMes());new google.visualization.PieChart(document.getElementById("div_graf_biomas_mes")).draw(o,e),updateLoading(10)}}};function returnColor(a){for(var e in biomas.props)if(biomas.props[e].name==a.bioma)return biomas.props[e].color;return"#cccccc"}function updateGraphs(){google.charts.load("current",{packages:["table","bar","corechart"]}),google.charts.setOnLoadCallback(qmd.graphics.table_months),google.charts.setOnLoadCallback(qmd.graphics.table_years),google.charts.setOnLoadCallback(qmd.graphics.graphic_year),google.charts.setOnLoadCallback(qmd.graphics.graphic_month)}function montaFiltros(a){if("string"==typeof a)a=$(0==$.inArray(a.split(0,1),["#",".","<"])?a:"#"+a);else{if("object"!=typeof a)return!1;a=$(a)}var e=$("<div>"),o=$("<div>").attr({id:"filtro_ano"}).addClass("btn-group");o.append($("<span>").addClass("btn btn-secondary dropdown-toggle").attr({"data-toggle":"dropdown","aria-haspopup":"true","aria-expand":"false"}).html("Ano selecionado: "+ano.atual));for(var t=$("<div>").addClass("dropdown-menu"),n=ano.primeiro;n<=ano.ultimo;n++)t.append($("<button>").attr({id:"a"+n}).addClass("dropdown-item"+(n==ano.atual?" active":"")).html(n));o.append(t),e.append($("<div>").css({display:"block",width:"100%",height:"40px"}).append(o));var s=$("<div>").attr({id:"filtro_mes"}).addClass("nav nav-pills");for(n=1;n<=12;n++){var i="image.php?_&ano="+ano.atual+"&mes="+(n<10?"0":"")+n;if((ano.atual==ano.primeiro&&n<mes.primeiro||n>mes.ultimo)&&(i="./assets/images/logo_marca_dagua.png"),ano.atual!=ano.anterior){var r=new Image;r.src=i,r.onerror=function(){this.src=i},$(r).attr({id:"m"+n}).addClass("img-thumbnail");var l=$("<label>").html(mes.label[n]);s.append($("<div>").attr({id:"m"+n}).append(r,l).addClass("nav-item btn-"+(n==parseInt(mes.atual)?"warning":"default")))}else s.append($("#m"+n).removeClass("btn-warning").addClass("btn-"+(n==parseInt(mes.atual)?"warning":"default")));e.append(s)}ano.atual!=ano.anterior&&(ano.anterior=ano.atual);var m=$("<div>").attr({id:"filtro_bioma"}).addClass("btn-group");for(n=0;n<biomas.props.length;n++){var d=biomas.props[n];m.append($("<button>").attr({id:"b"+n}).html(d.name).addClass("btn btn-"+(biomas.atual==n?"warning":"default")+" bioma "+d.id))}e.append(m),a.empty().append(e.children())}function updateBiomas(){extent=map.getView().calculateExtent(map.getSize()),extent=ol.proj.transformExtent(biomas.props[biomas.atual].extents,"EPSG:4326","EPSG:3857"),view.fit(extent,map.getSize(),{constrainResolution:!1}),layer_biomas.getSource().setUrl(area_queimada_wms+"&bioma="+biomas.props[biomas.atual].wms_name)}function mudaMesAno(){if(getMesesAno(),updateGraphs(),updateBiomas(),"number"==typeof mes.atual&&mes.atual<mes.label.length){0<mes.atual&&layer_aq_renata.getSource().setUrl(area_queimada_wms+"&ano="+ano.atual+"&mes="+(mes.atual<10?"0":"")+mes.atual);var a="para "+(0!=biomas.atual?"o bioma ":"todos os biomas do ")+biomas.props[biomas.atual].name+(0==mes.atual?" no ano ":" em "+mes.label[mes.atual])+" de "+ano.atual,e="por bioma em "+(0==mes.atual?"":mes.label[mes.atual]+" de ")+ano.atual;$("#mapa .card-title, #grafico_ano .card-title").html(a),$("#tabela_mes .card-title, #grafico_mes .card-title").html(e),$("#tabela_ano .card-title").html("")}updateLoading(10)}function confereAnos(){ano.atual===ano.ultimo&&mes.atual>mes.ultimo&&(mes.atual=mes.ultimo),ano.atual===ano.primeiro&&mes.atual<mes.primeiro&&(mes.atual=mes.primeiro)}function callAjax(url,cb){$.ajax({url:url+"?_="+(new Date).getTime(),async:!1,dataType:"text",success:function(a){data=$.csv.toArrays(a,{separator:","})},complete:function(){updateLoading(25),eval(cb+"(data)")}})}function geraDadosBiomasAnos(){var a=[],e=ano.primeiro;for(var o in biomas.mes.body){var t=biomas.mes.body[o];if("Total anual"===t[0]){var n=[e];for(j=2;j<t.length;j++)n.push(t[j]);a.push(n)}else e=t[0]}for(o=0;o<biomas.mes.head.length-1;o++)1!=o&&biomas.ano.head.push(biomas.mes.head[o]);biomas.ano.head.push("Total anual"),biomas.ano.body=a,updateLoading(15),mudaMesAno()}function geraDadosBiomas(a){if(void 0===a[0])return null;biomas.mes.head=a[0];var e=a.slice(1);for(i in e)for(j in e[i])0<j&&(""==e[i][j]?e[i][j]=0:e[i][j]=parseInt(e[i][j]));updateLoading(10),biomas.mes.body=e,geraDadosBiomasAnos()}function getAnos(){var a=[];for(var e in a.push(biomas.ano.head),biomas.ano.body){var o=biomas.ano.body[e],t=[o[0]];for(j in biomas.props){var n=o[0==j?biomas.props.length:parseInt(j)],s=biomas.props[j].area,i=(100*parseInt(n)/s).formatIt(2,"",".",","),r=parseInt(n).formatIt(0,"",".",",");0<j?t.splice(t.length-1,0,r+" ("+i+"%)"):t.push(r+" ("+i+"%)")}a.push(t)}return a}function getMesesAno(){for(var a=0,e=0;e<biomas.mes.body.length;e++)if(biomas.mes.body[e][0]==ano.atual){a=e;break}var o=[];o.push(biomas.mes.head);for(e=a;e<=a+12&&void 0!==biomas.mes.body[e];e++)o.push(biomas.mes.body[e]);mes.ultimo=o.length-2,confereAnos(),ano.arrayMeses=o}function getMeses(){return ano.arrayMeses}function getGraficoBiomaMesesAno(){var a=[],e=[];for(var o in biomas.mes.head)o<biomas.mes.head.length-1&&(1==o||1<o&&0==biomas.atual||1<o&&biomas.atual==o-1)&&e.push(biomas.mes.head[o]);for(var o in a.push(e),biomas.mes.body){var t=biomas.mes.body[o];if(t[0]==ano.atual){var n=[];for(var s in t)0<s&&s<t.length-1&&(1==s||1<s&&0==biomas.atual||1<s&&biomas.atual==s-1)&&n.push(1==s?mes.label[t[s]].substr(0,3):t[s]);a.push(n)}}return a}function getGraficoBiomasMes(){for(var a=biomas.mes.head,e=[["Bioma","KM²"]],o=ano.atual,t=0;t<biomas.mes.body.length;t++){var n=biomas.mes.body[t];if(o="Total anual"!==n[0]?n[0]:o,(n[0]==ano.atual||"Total anual"==n[0]&&o==ano.atual)&&n[1]==parseInt(mes.atual)){for(var s=2;s<n.length-1;s++)e.push([a[s],n[s]]);break}}return e}function updateLoading(a){loaded=100<loaded+a?100:loaded+a,$(".bg-loading span").css({width:loaded+"%"}),$(".bg-loading label").html("Carregando os dados da página ("+loaded+"%)"),100==loaded&&$(".bg-loading").hide()}function updateLogo(){$(window).width()<920?$("#logo img").attr("src","assets/images/simb_logo.png"):$("#logo img").attr("src","assets/images/simb_logo_conj.png")}$(document).ready(function(){$(".bg-loading").show(),updateLoading(0),callAjax("assets/data/Valores_Pixel_todos_biomas_urbano_2016_valor_1.csv","geraDadosBiomas")}),$(document).on("click","table.metadata-ano tr",function(a){var e=parseInt($(this).find("td:nth-child(2)").text());mes.atual=e<0?0:e,confereAnos(),mudaMesAno()}),$(document).on("click","#filtro_ano button",function(a){ano.atual=parseInt(a.target.id.replace("a","")),confereAnos(),mudaMesAno()}),$(document).on("click","#filtro_mes .nav-item",function(a){mes.atual=parseInt(a.target.id.replace("m","")),mudaMesAno()}),$(document).on("click","#filtro_bioma button",function(a){biomas.atual=parseInt(a.target.id.replace("b","")),confereAnos(),mudaMesAno()}),$(document).on("click","table.metadata-anos tr",function(a){$("html, body").animate({scrollTop:$("#filtros").offset().top},1e3),ano.atual=parseInt(""!=$(this).find("td:first").text()?parseInt($(this).find("td:first").text()):ano.atual),confereAnos(),mudaMesAno()}),extent=map.getView().calculateExtent(map.getSize()),extent=ol.proj.transformExtent(biomas.props[0].extents,"EPSG:4326","EPSG:3857"),view.fit(extent,map.getSize(),{constrainResolution:!1}),$(document).on("click","#siteaction-contraste a",function(a){a.preventDefault(),contrast||$("body").hasClass("contrast")?(contrast=!1,$("body").removeClass("contrast")):(contrast=!0,$("body").addClass("contrast")),mudaMesAno()}),$(document).ready(function(a){0==$(".topo ul").length&&$(".topo").append($("#accessibility").clone())}),Number.prototype.formatIt=function(a,e,o,t){a=isNaN(a=Math.abs(a))?0:a,e=void 0!==e?e:"$",o=o||",",t=t||".";var n=this,s=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(a),10)+"",r=3<(r=i.length)?r%3:0;return e+s+(r?i.substr(0,r)+o:"")+i.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+o)+(a?t+Math.abs(n-i).toFixed(a).slice(2):"")},$(document).ready(function(){updateLogo()}),$(window).resize(function(){updateLogo()});


  function getParameterByName(name) { 
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }